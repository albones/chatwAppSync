(this.webpackJsonpchatapp=this.webpackJsonpchatapp||[]).push([[0],{154:function(e,n){},165:function(e,n){},317:function(e,n,t){e.exports=t(880)},321:function(e,n,t){},880:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(36),c=t.n(o),i=(t(321),t(100)),s=t(71),u=t(101),m=t(102),d=t(106),l=t(89),p=t.n(l),f=t(139),h=t(135),b=t.n(h),g=t(93),w=t(312),y=t(13),v=t(290),_=t(143),O=t(84),j={aws_project_region:"us-west-2",aws_cognito_identity_pool_id:"us-west-2:22ad3a45-0c50-4cd3-aeca-ee139835a84b",aws_cognito_region:"us-west-2",aws_user_pools_id:"us-west-2_5CCbd8H1R",aws_user_pools_web_client_id:"2gq3f9887krk0t1qkjvbapq4pk",oauth:{},aws_appsync_graphqlEndpoint:"https://ni4vxhw3gvfetdnrela7af2szy.appsync-api.us-west-2.amazonaws.com/graphql",aws_appsync_region:"us-west-2",aws_appsync_authenticationType:"AMAZON_COGNITO_USER_POOLS"},E=t(73),I=t(91),R=t(904),k=t(905),C=t(906),M=t(909),q=t(907),D=t(910),$=t(908),S=t(293),x=t.n(S),A=t(92),T=t.n(A),L=t(118),Q=t.n(L),N=t(78);function G(){var e=Object(I.a)(["\n  mutation CreateRoom($id: ID!) {\n    createRoom(input: { id: $id }) {\n      __typename\n      id\n      createdAt\n    }\n  }\n"]);return G=function(){return e},e}function J(){var e=Object(I.a)(["\n  query ListRooms {\n    listRooms {\n      items {\n        __typename\n        id\n        createdAt\n      }\n    }\n  }\n"]);return J=function(){return e},e}var P=T()(J()),z=T()(G()),B=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.b,{query:P,fetchPolicy:"cache-and-network"},(function(e){var n=e.data,t=e.loading,a=e.error;return a?r.a.createElement("div",null,a.message):t?r.a.createElement(R.a,null):r.a.createElement(k.a,{subheader:r.a.createElement(C.a,{component:"div"},"List of rooms"),dense:!0},n.listRooms.items.map((function(e){return r.a.createElement(M.a,{key:e.id,divider:!0},r.a.createElement(q.a,{style:{flex:1},component:_.b,to:"/room/".concat(e.id)},r.a.createElement(D.a,{primary:e.id,secondary:"Created at ".concat(e.createdAt)})))})))})),r.a.createElement(N.a,{mutation:z},(function(e){return r.a.createElement($.a,{color:"primary","aria-label":"Add",style:{position:"absolute",bottom:10,right:10},onClick:function(){var n=Q()();e({variables:{id:n},optimisticResponse:function(){return{createRoom:{__typename:"Room",id:n,createdAt:new Date}}},update:function(e,n){var t=n.data.createRoom,a=e.readQuery({query:P});a.listRooms.items=[t].concat(Object(E.a)(a.listRooms.items.filter((function(e){return e.id!==t.id})))),e.writeQuery({query:P,data:a})}})}},r.a.createElement(x.a,null))})))},U=t(184),W=t(14),F=t(294),H=function(e){function n(){return Object(i.a)(this,n),Object(u.a)(this,Object(m.a)(n).apply(this,arguments))}return Object(d.a)(n,e),Object(s.a)(n,[{key:"componentDidMount",value:function(){this.props.subscribeToNewMessages()}},{key:"onSend",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];n.map((function(n){return e.props.onSend(n.text)}))}},{key:"render",value:function(){var e=this,n=this.props,t=n.loading,a=n.error,o=n.data,c=n.user;if(a)return r.a.createElement("div",null,a.message);if(t)return r.a.createElement("div",null,"Loading");var i=o.getRoom.messages.items;return r.a.createElement("div",{style:Z.container},r.a.createElement(F.GiftedChat,{messages:i.map((function(e){return{id:e.id,text:e.content,createdAt:new Date(e.when),user:{id:e.owner,name:e.owner}}})),onSend:function(n){return e.onSend(n)},user:{id:c}}))}}]),n}(r.a.Component),Z={container:{flex:1,height:"100vh"}},K=H;function V(){var e=Object(I.a)(["\n  subscription OnCreateMessage($roomId: ID!) {\n    onCreateMessage(roomId: $roomId) {\n      __typename\n      id\n      when\n      content\n      owner\n      roomId\n    }\n  }\n"]);return V=function(){return e},e}function X(){var e=Object(I.a)(["\n  query GetRoomMessages($roomId: ID!) {\n    getRoom(id: $roomId) {\n      __typename\n      messages(limit: 20, sortDirection: DESC) {\n        __typename\n        items {\n          __typename\n          id\n          when\n          content\n          owner\n        }\n      }\n    }\n  }\n"]);return X=function(){return e},e}function Y(){var e=Object(I.a)(["\n  mutation createMessage($roomId: ID!, $when: String!, $content: String!) {\n    createMessage(input: { roomId: $roomId, when: $when, content: $content }) {\n      __typename\n      id\n      when\n      content\n      owner\n      roomId\n    }\n  }\n"]);return Y=function(){return e},e}var ee=T()(Y()),ne=T()(X()),te=T()(V());var ae,re=(ae=function(e){var n=e.match,t=e.username;return r.a.createElement(N.b,{variables:{roomId:n.params.roomId},query:ne,fetchPolicy:"cache-and-network"},(function(e){var a=e.data,o=e.subscribeToMore,c=Object(W.a)(e,["data","subscribeToMore"]);return r.a.createElement(N.a,{mutation:ee},(function(e){return r.a.createElement(K,Object.assign({},c,{user:t,data:a,subscribeToNewMessages:function(){o({document:te,variables:{roomId:n.params.roomId},updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var a=t.data.onCreateMessage;return Object.assign({},e,{getRoom:Object(U.a)({},e.getRoom,{messages:Object(U.a)({},e.getRoom.messages,{items:[a].concat(Object(E.a)(e.getRoom.messages.items.filter((function(e){return e.id!==a.id}))))})})})}})},onSend:function(a){e({variables:{content:a,roomId:n.params.roomId,when:new Date},optimisticResponse:function(){return{createMessage:{__typename:"Message",id:Q()(),when:new Date,owner:t,content:a}}},update:function(e,t){var a=t.data.createMessage,r=e.readQuery({query:ne,variables:{roomId:n.params.roomId}});r.getRoom.messages.items=[a].concat(Object(E.a)(r.getRoom.messages.items.filter((function(e){return e.id!==a.id})))),e.writeQuery({query:ne,variables:{roomId:n.params.roomId},data:r})}})}}))}))}))},function(e){function n(){var e,t;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=Object(u.a)(this,(e=Object(m.a)(n)).call.apply(e,[this].concat(r)))).state={username:null},t}return Object(d.a)(n,e),Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=Object(f.a)(p.a.mark((function e(){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a.currentAuthenticatedUser();case 2:n=e.sent,this.setState({username:n.username});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.username;return e?r.a.createElement(ae,Object.assign({},this.props,{username:e})):"Loading..."}}]),n}(r.a.Component));g.b.configure(j);var oe=new b.a({url:j.aws_appsync_graphqlEndpoint,region:j.aws_appsync_region,auth:{type:j.aws_appsync_authenticationType,credentials:function(){return g.a.currentCredentials()},jwtToken:function(){var e=Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a.currentSession();case 2:return e.abrupt("return",e.sent.getAccessToken().getJwtToken());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},complexObjectsCredentials:function(){return g.a.currentCredentials()}}),ce=function(e){function n(){return Object(i.a)(this,n),Object(u.a)(this,Object(m.a)(n).apply(this,arguments))}return Object(d.a)(n,e),Object(s.a)(n,[{key:"render",value:function(){return r.a.createElement(y.b,{client:oe},r.a.createElement(v.Rehydrated,null,r.a.createElement(_.a,null,r.a.createElement(O.c,null,r.a.createElement(O.a,{path:"/room/:roomId",component:re}),r.a.createElement(O.a,{path:"/",component:B})))))}}]),n}(a.Component),ie=Object(w.a)(ce);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(ie,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[317,1,2]]]);
//# sourceMappingURL=main.6e33f56e.chunk.js.map