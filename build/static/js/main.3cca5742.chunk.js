(this.webpackJsonpchatapp=this.webpackJsonpchatapp||[]).push([[0],{157:function(e,n){},293:function(e,n,t){e.exports=t(794)},297:function(e,n,t){},794:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(93),s=t.n(o),i=(t(297),t(104)),c=t(74),u=t(105),m=t(106),d=t(110),p=t(95),l=t.n(p),f=t(142),h=t(138),b=t.n(h),g=t(99),w=t(290),v=t(20),y=t(268),_=t(175),O=t(89),j={aws_project_region:"us-west-2",aws_cognito_identity_pool_id:"us-west-2:22ad3a45-0c50-4cd3-aeca-ee139835a84b",aws_cognito_region:"us-west-2",aws_user_pools_id:"us-west-2_5CCbd8H1R",aws_user_pools_web_client_id:"2gq3f9887krk0t1qkjvbapq4pk",oauth:{},aws_appsync_graphqlEndpoint:"https://ni4vxhw3gvfetdnrela7af2szy.appsync-api.us-west-2.amazonaws.com/graphql",aws_appsync_region:"us-west-2",aws_appsync_authenticationType:"AMAZON_COGNITO_USER_POOLS"},I=t(76),E=t(97),R=t(820),k=t(270),C=t.n(k),M=t(98),q=t.n(M),D=t(119),$=t.n(D),S=t(83);function x(){var e=Object(E.a)(["\n  mutation CreateRoom($id: ID!) {\n    createRoom(input: { id: $id }) {\n      __typename\n      id\n      createdAt\n    }\n  }\n"]);return x=function(){return e},e}function A(){var e=Object(E.a)(["\n  query ListRooms {\n    listRooms {\n      items {\n        __typename\n        id\n        createdAt\n      }\n    }\n  }\n"]);return A=function(){return e},e}var T=q()(A()),Q=q()(x()),L=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(S.a,{mutation:Q},(function(e){return r.a.createElement(R.a,{color:"primary","aria-label":"Add",style:{position:"absolute",bottom:10,right:10},onClick:function(){var n=$()();e({variables:{id:n},optimisticResponse:function(){return{createRoom:{__typename:"Room",id:n,createdAt:new Date}}},update:function(e,n){var t=n.data.createRoom,a=e.readQuery({query:T});a.listRooms.items=[t].concat(Object(I.a)(a.listRooms.items.filter((function(e){return e.id!==t.id})))),e.writeQuery({query:T,data:a})}})}},r.a.createElement(C.a,null))})))},N=t(178),G=t(32),J=t(271),z=function(e){function n(){return Object(i.a)(this,n),Object(u.a)(this,Object(m.a)(n).apply(this,arguments))}return Object(d.a)(n,e),Object(c.a)(n,[{key:"componentDidMount",value:function(){this.props.subscribeToNewMessages()}},{key:"onSend",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];n.map((function(n){return e.props.onSend(n.text)}))}},{key:"render",value:function(){var e=this,n=this.props,t=n.loading,a=n.error,o=n.data,s=n.user;if(a)return r.a.createElement("div",null,a.message);if(t)return r.a.createElement("div",null,"Loading");var i=o.getRoom.messages.items;return r.a.createElement("div",{style:B.container},r.a.createElement(J.GiftedChat,{messages:i.map((function(e){return{id:e.id,text:e.content,createdAt:new Date(e.when),user:{id:e.owner,name:e.owner}}})),onSend:function(n){return e.onSend(n)},user:{id:s}}))}}]),n}(r.a.Component),B={container:{flex:1,height:"100vh"}},P=z;function U(){var e=Object(E.a)(["\n  subscription OnCreateMessage($roomId: ID!) {\n    onCreateMessage(roomId: $roomId) {\n      __typename\n      id\n      when\n      content\n      owner\n      roomId\n    }\n  }\n"]);return U=function(){return e},e}function W(){var e=Object(E.a)(["\n  query GetRoomMessages($roomId: ID!) {\n    getRoom(id: $roomId) {\n      __typename\n      messages(limit: 20, sortDirection: DESC) {\n        __typename\n        items {\n          __typename\n          id\n          when\n          content\n          owner\n        }\n      }\n    }\n  }\n"]);return W=function(){return e},e}function F(){var e=Object(E.a)(["\n  mutation createMessage($roomId: ID!, $when: String!, $content: String!) {\n    createMessage(input: { roomId: $roomId, when: $when, content: $content }) {\n      __typename\n      id\n      when\n      content\n      owner\n      roomId\n    }\n  }\n"]);return F=function(){return e},e}var H=q()(F()),Z=q()(W()),K=q()(U());var V,X=(V=function(e){var n=e.match,t=e.username;return r.a.createElement(S.b,{variables:{roomId:n.params.roomId},query:Z,fetchPolicy:"cache-and-network"},(function(e){var a=e.data,o=e.subscribeToMore,s=Object(G.a)(e,["data","subscribeToMore"]);return r.a.createElement(S.a,{mutation:H},(function(e){return r.a.createElement(P,Object.assign({},s,{user:t,data:a,subscribeToNewMessages:function(){o({document:K,variables:{roomId:n.params.roomId},updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var a=t.data.onCreateMessage;return Object.assign({},e,{getRoom:Object(N.a)({},e.getRoom,{messages:Object(N.a)({},e.getRoom.messages,{items:[a].concat(Object(I.a)(e.getRoom.messages.items.filter((function(e){return e.id!==a.id}))))})})})}})},onSend:function(a){e({variables:{content:a,roomId:n.params.roomId,when:new Date},optimisticResponse:function(){return{createMessage:{__typename:"Message",id:$()(),when:new Date,owner:t,content:a}}},update:function(e,t){var a=t.data.createMessage,r=e.readQuery({query:Z,variables:{roomId:n.params.roomId}});r.getRoom.messages.items=[a].concat(Object(I.a)(r.getRoom.messages.items.filter((function(e){return e.id!==a.id})))),e.writeQuery({query:Z,variables:{roomId:n.params.roomId},data:r})}})}}))}))}))},function(e){function n(){var e,t;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=Object(u.a)(this,(e=Object(m.a)(n)).call.apply(e,[this].concat(r)))).state={username:null},t}return Object(d.a)(n,e),Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=Object(f.a)(l.a.mark((function e(){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a.currentAuthenticatedUser();case 2:n=e.sent,this.setState({username:n.username});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.username;return e?r.a.createElement(V,Object.assign({},this.props,{username:e})):"Loading..."}}]),n}(r.a.Component));g.b.configure(j);var Y=new b.a({url:j.aws_appsync_graphqlEndpoint,region:j.aws_appsync_region,auth:{type:j.aws_appsync_authenticationType,credentials:function(){return g.a.currentCredentials()},jwtToken:function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a.currentSession();case 2:return e.abrupt("return",e.sent.getAccessToken().getJwtToken());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},complexObjectsCredentials:function(){return g.a.currentCredentials()}}),ee=function(e){function n(){return Object(i.a)(this,n),Object(u.a)(this,Object(m.a)(n).apply(this,arguments))}return Object(d.a)(n,e),Object(c.a)(n,[{key:"render",value:function(){return r.a.createElement(v.b,{client:Y},r.a.createElement(y.Rehydrated,null,r.a.createElement(_.a,null,r.a.createElement(O.c,null,r.a.createElement(O.a,{path:"/room/:roomId",component:X}),r.a.createElement(O.a,{path:"/",component:L})))))}}]),n}(a.Component),ne=Object(w.a)(ee);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(ne,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[293,1,2]]]);
//# sourceMappingURL=main.3cca5742.chunk.js.map